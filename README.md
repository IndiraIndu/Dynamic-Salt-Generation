# Storing secrets with a pinch of invisible salt

Storing api keys or cryptographic keys is a common requirement from an iOS developer. But with the current reverse engineering techniques, sensitive keys that are stored in mach-o executable can be extracted out of the application. (Example: strings, hopper). The current known solution to hide these sensitive information is String obfuscation. With this technique, variable values can be encrypted and the same can be decrypted at application runtime. In order to enhance the robustness of the encryption, salting has been used in third party libraries like Obfuscator-iOS. In this approach, sensitive strings  are encrypted along with a static salt. And the same salt is used for decryption. Here, as salt has been stored on the client side, it can be extracted using debuggers like LLDB. 

To overcome this drawback, we are proposing a novel dynamic salting technique, in which the salt is not stored anywhere in the application source code and will be generated dynamically whenever necessary. In existing dynamic salting techniques, the class name is directly taken as salt and appended to the sensitive string. Consequently all the strings in a particular class will have the same salt value resulting in decrease of randomness that the dynamic salt provides. In our employed technique, salt is calculated with not just class name but also method, line and column number as parameters. So this salt generated will be unique for every class and method combination it is being invoked by, making it difficult for an adversary with obfuscated source code to predict. The following is the detailed implementation of generated dynamic salt.

Dynamic Salt Implementation:

Code Obfuscation: Our first step in dynamic salt generation is to obfuscate the source code and get the obscured method and class names.

Identify sensitive strings: Code obfuscation typically obscures the method and class names but leaves out strings as such.

Dynamic salt generation: A salt is generated dynamically based on the class, method, line and column number from where it is invoked by.

Salting: To make the encryption more robust, the dynamically generated salt is added to the sensitive string. 

Encrypting the salted string: The salted string is now encrypted using a strong cryptographic algorithm. And the sensitive strings in the source code are now replaced with encrypted strings.
 
Decrypting the obscured string: The encrypted string is decrypted using the same cryptographic algorithm to get the salted string. This salted string and salt regenerated by passing the same parameters are used to get back the original string.

Although multiple method calls for encryption demand a compromise on the performance of the application, the security concern with exposing sensitive keys cannot be disregarded. An attacker being able to decrypt your application's binary and running strings from the command line to simply dump all the literal strings is not a scenario to be neglected. We have implemented this dynamic salting on an sample application to increase the obscurity of the code, making it difficult for an adversary to discern it. Security standard of retail applications (where storing of sensitive strings like api or cryptographic keys) can be strengthened from this technique of dynamic salting.
